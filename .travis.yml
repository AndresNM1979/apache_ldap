language: python
services:
  - docker
addons:
  apt:
    packages:
    - ldap-utils
    - python-ldap
virtualenv:
    system_site_packages: true
script:
    - docker build -t apacheds-test .
    - docker run -d --name apacheds-test -p 10389:10389 apacheds-test
    - sleep 10
    - echo "Old style"
    - bin/initialize
    - bin/group public add
    - bin/user public add
    - bin/user public in public
    - bin/search
    - yes | bin/clear
    - echo "New style"
    - bin/ldapo init
    - bin/ldapo user public --password public
    - bin/ldapo group public --member public
    - bin/ldapo get 'uid=public,ou=Users,dc=openmicroscopy,dc=org'
    - bin/ldapo search 'uid=public'
    - bin/ldapo search
    - bin/ldapo clear
    - docker rm -f apacheds-test
